[>>>点击观看视频讲解](https://www.bilibili.com/video/av47725391)

标题: 一次请求涉及的网络协议

关键词：网络,编程,网络协议,网络请求,协议,趣谈网络协议

摘要：

> 视频讲解打开一个网页时，请求从浏览器出发，到达网站服务器，再被服务端处理，所涉及的网络协议

你好，我是好刚，这一讲我们来了解网络协议，我将通过在浏览器中打开一个网页的请求过程，来了解互联网技术中常用的网络协议。

先说明视频内容来源，这期视频内容来源于极客时间刘超老师的课程《趣谈网络协议》第1 讲的内容。这是《趣谈网络协议》课程的地址。

一次网络请求包含三个部分：发请求，网络传输和请求处理。

![](images/20190331220842.png)

## 1. 发请求

### 1.1 DNS

先看发请求，假设你在浏览器里面输入网址，网址一般是一个域名，只有域名还需要知道具体的IP 地点，需要使用DNS 域名解析协议去查找这个域名的IP 地址。


### 1.2 HTTP

知道了目标IP 地址，浏览器就开始打包它的请求。对于普通的浏览请求，往往会使用HTTP协议；现在为了安全，往往需要进行加密传输，因而会使用HTTPS协议。

### 1.3 TCP

DNS、HTTP 所在的层我们称为应用层。经过应用层封装后，浏览器会将应用层的数据包交给下一层传输层去传输。对于HTTP 请求，主要使用的是 TCP 协议。

### 1.4 IP

传输层封装完毕后，浏览器会将包交给操作系统的网络层，对应的是 IP 协议。

经过IP 层的封装，数据包成为IP 包，里面会有浏览器所在机器的 IP 地址和目标服务器 IP 地址，然后操作系统再将IP 包发给网关，这里网关往往是一个路由器。在操作系统启动的时候会通过 DHCP 协议配置电脑的 IP 地址和网关 IP 地址， 默认网关IP 地址是 192.168.1.1。

### 1.5 ARP

这里有个细节需要注意下，操作系统如何将 IP 包发给网关呢？操作系统会给本地局域网所有设备发一条询问请求，谁是 192.168.1.1 啊？网关会回答告诉操作系统网关的MAC 地址是多少，这里获取IP 所在机器MAC 地址的协议是ARP协议，专门用来获取本地网络的MAC 地址。

### 1.6 网关

在拿到网关的MAC 地址后，操作系统将 IP 包交给下一层 MAC 层。这里网卡会将包发出去，由于这个包里面是有网关的 MAC 地址它就能到达网关。

前面提到网关往往是一个路由器，再收到数据包之后，会判断到目标服务器IP 接下来应该怎么走。

## 2. 请求传输

### 2.1 路由协议

网关知道数据包接下来怎么走，这是因为网关作为路由器，相互之间会经常沟通，到哪里应该怎么走，这种沟通的协议称为路由协议。

数据包传向下一个网关，然后问要到目标IP 地址下一步怎么走，这样一直到走到最后一个网关。

### 2.2 目标服务器

最后一个网关拿到数据包，对着这个局域网吼一声，谁是目标 IP 啊？目标服务器就会回复一个 MAC 地址。数据包就能发送到目标服务器。这里根据IP 获取目标服务器MAC 地址又用到了ARP 协议。

### 2.3 TCP 回复

目标服务器收到数据包后发现 MAC 地址对上了，就取下 MAC 头，发送给操作系统的网络层，对应的是IP 协议。如果目标 IP 也对上了，就将其交给传输层，也就是TCP 层。

在TPC 这层里，对收到的每个包，都会有一个回复来告诉发送端数据包已经收到了。要注意这个回复不是这次请求的结果，而仅仅是 TCP 层的一个确认回复，因为数据包一旦出了网关，传输过程中可能因为各种原因丢失，所以收到数据包后要报个平安。

发送端如果一段时间没有收到这个回复，在TCP 层会重新发送这个包，直到收到数据包平安到达的回复，这也是为什么TCP 被称为面向连接的可靠的传输协议。

需要注意：这个重试不是你的浏览器重新将下单这个动作重新请求一次。对于浏览器来讲，就发送了一次下单请求，是TCP 层自己不断闷头重试。

## 3. 请求处理

### 3.1 进程处理

当网络包平安到达 TCP 层之后，TCP 包中有目标端口号，通过这个端口号，可以找到服务器上正在监听这个端口号的进程，假设是一个 Tomcat，这个包将发给这个进程处理。

Tomcat 得到 HTTP 请求的内容，知道了要请求那个网页，往往这个 Tomcat 只是个接待员，负责统筹处理这个请求，而不是所有的事情都自己做。这个接待员要告诉专门的进程去处理这个网页的内容。

如何告诉相关的进程呢？往往通过 RPC 调用，也就是远程过程调用的方式来实现，这里就用到了RPC 协议。

当处理完毕，服务器就回复一个 HTTPS 的包，这个数据包会像来的时候一样，经过千难万险到达你的电脑，最后浏览器将网页显示给你。

这就是打开一个网页时，请求从浏览器出发，到达网站服务器的过程。

## 小结

最后小结，这一讲我们了解了网络请求涉及了哪些协议，包括DNS 协议，HTTP 协议，TCP 协议，IP 协议，ARP 协议，路由协议，RPC 协议。

再次声明这篇视频是极客时间刘超老师《趣谈网络协议》课程第1 讲的学习笔记，内容没有原版详细，如果你想深入了解网络协议，就请订阅课程，这是《趣谈网络协议》课程的地址。

如果这个讲解对你有所帮助，也请你帮忙关注和转发，这个很重要。我是好刚，让技术更好懂，我们下一期视频再见。
